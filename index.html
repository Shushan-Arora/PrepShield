<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login | PrepShield</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../assets/css/style.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" type="text/css" />
    <link rel="apple-touch-icon" href="./assets/img/apple-touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="PrepShield">
    <link rel="shortcut icon" href="https://prepshield.web.app/assets/img/shortcut-icon-removebg-preview.png" />

    <style>
        body {
            /*background: linear-gradient(to right, #f8f9fa, #e9ecef);*/
            font-family: Arial, sans-serif;
            margin: 0; /* Ensure no margin is applied to body */
            height: 100vh; /* Ensure the body takes full viewport height */
            z-index:none;
            overflow:hidden;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-family: "Radio Canada Big", sans-serif;
        }
        .card {
            margin-top: -5rem; /* Adjust this value to push the box up */
        }
        .card-body {
            padding: 2rem;
        }
        .card-title {
            margin-bottom: 0px;
            font-size: 38px;
            color: #343a40;
        }
       
        .form-label {
            font-weight: bold;
            color: #495057;
        }
        .form-control {
            border-radius: 0px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
            border-color: lightgrey;
            padding:10px;
        }
        .form-control:focus{
          border-color: #014c43;
        }
        .btn-primary {
            background-color: #027063;
            border-color: #027063;
            border-radius: 10px;
            padding: 0.75rem;
        }
        .btn-primary:hover {
            background-color: #014c43;
            border-color: #014c43;
        }
        a{
          text-decoration:none;
          font-size:15px;
        }

        @media only screen and (max-width: 480px) {
          .card{
            border:none;
            margin-top:-10rem;
            width:110%;
            margin-left:-20px;
          }
        }
    </style>
  </head>
  <body>
    <nav style="background-color:white !important;" class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="https://prepshield.web.app">PrepShield <i class="fa-solid fa-shield"></i></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" href="https://prepshield.web.app/#section1">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://prepshield.web.app/#section2">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://prepshield.web.app/#section3">Creators</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://prepshield.web.app/#section4">Contact</a>
            </li>
          </ul>
          <a id="loginNav" href="https://prepshield.web.app/login" class="nav-link nav-login">Log In</a>
          <a id="beginNow" onClick="authenticateUser();" class="nav-link nav-register">Begin Now - <span style="color:rgb(190, 190, 190);">It's Free</span></a>
        </div>
      </div>
    </nav>
      
      <div class="main">
        <div class="container d-flex justify-content-center align-items-center vh-100">
            <div class="row w-100">
                <div class="col-md-6 col-lg-6 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Sign in</h5>
                            <a style="margin-bottom:10px !important;">Don't have an account? <a href="https://prepshield.web.app/register">Sign Up</a></a>
                            <div style="margin-top:10px;">
                                <div class="mb-3">
                                    <label id="label-email" for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" placeholder="Enter email" autocomplete="off">
                                </div>
                                <div class="mb-3">
                                    <label id="label-password" for="password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="password" placeholder="Enter password">
                                </div>
                                <button id="loginBtn" onClick="login();" class="btn btn-primary w-100">Login</button>
                              </div>

                              <div id="login-error" style="padding:7px;font-size:12px;margin-top:8px;" class="alert alert-danger" role="alert">
                                We weren't able to find your account, make sure you've spelled everything correctly
                              </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-database.js"></script>

    <script>
       var firebaseConfig = {
        apiKey: "AIzaSyBpbLWqBGV6HRhV44bcI9KtFsatfH1JAkM",
  authDomain: "prepshield.firebaseapp.com",
  projectId: "prepshield",
  storageBucket: "prepshield.appspot.com",
  messagingSenderId: "727779078443",
  appId: "1:727779078443:web:ca769eaa8975450e47556e"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth().currentUser;

        let loginError = document.getElementById("login-error");
        loginError.hidden = true;

        const user = firebase.auth().currentUser;
        let loginNav = document.getElementById("loginNav");

        function authenticateUser(){
  firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    const dbRef = firebase.database().ref();
dbRef.child("users").child(firebase.auth().currentUser.uid).get().then((snapshot) => {
  if (snapshot.exists()) {
    console.log(snapshot.val());

    
    if(snapshot.val().joinedFamily == ""){
      window.location.assign("https://prepshield.web.app/user/new/start-connecting");
    }else{
      window.location.assign("https://prepshield.web.app/user/my-family/home?familyId=" + snapshot.val().joinedFamily)
    }
  } else {
    console.log("No data available");

    window.location.assign("https://prepshield.web.app/register");
  }
}).catch((error) => {
  console.error(error);
});
  } else {
    // User is signed out
    // ...

    window.location.assign("https://prepshield.web.app/register")
  }
});
}


        
        function login(){
          document.getElementById("loginBtn").disabled = true;
          document.getElementById("loginBtn").innerHTML = "Signing you in...";


          setTimeout(function(){
            if(document.getElementById("email").value == ""){
              document.getElementById("loginBtn").disabled = false;
              document.getElementById("loginBtn").innerHTML = "Login";
              document.getElementById("email").style = "border-color:rgb(155,11,11);";
              document.getElementById("label-email").innerHTML = "Email*";
              document.getElementById("label-email").style = "color:rgb(155,11,11);";
              document.getElementById("email").focus();
            }else{
              document.getElementById("loginBtn").disabled = true;
              document.getElementById("loginBtn").innerHTML = "Signing you in...";
              document.getElementById("email").style = "border-color:lightgrey;";
              document.getElementById("label-email").innerHTML = "Email";
              document.getElementById("label-email").style = "color:#495057;";

              loginTwo();
            }
          }, 1000)

        

         /**/
        }
  

       

        function loginTwo(){
          document.getElementById("loginBtn").disabled = true;
          document.getElementById("loginBtn").innerHTML = "Signing you in...";


          setTimeout(function(){
            if(document.getElementById("password").value == ""){
              document.getElementById("loginBtn").disabled = false;
              document.getElementById("loginBtn").innerHTML = "Login";
              document.getElementById("password").style = "border-color:rgb(155,11,11);";
              document.getElementById("label-password").innerHTML = "Password*";
              document.getElementById("label-password").style = "color:rgb(155,11,11);";
              document.getElementById("password").focus();
            }else{
              document.getElementById("loginBtn").disabled = true;
              document.getElementById("loginBtn").innerHTML = "Signing you in...";
              document.getElementById("password").style = "border-color:lightgrey;";
              document.getElementById("label-password").innerHTML = "Password";
              document.getElementById("label-password").style = "color:#495057;";

              loginThree();
            }
          }, 1000)
        }



        function loginThree(){
          setTimeout(function(){
            firebase.auth().signInWithEmailAndPassword(document.getElementById("email").value, document.getElementById("password").value)
  .then((userCredential) => {
    // Signed in
    var user = userCredential.user;
    const dbRef = firebase.database().ref();
dbRef.child("users").child(firebase.auth().currentUser.uid).get().then((snapshot) => {
  if (snapshot.exists()) {
    console.log(snapshot.val());

    let joinedFamily = snapshot.val().joinedFamily;

    window.location.assign("https://prepshield.web.app/user/my-family/home?familyId=" + joinedFamily)
  } else {
    console.log("No data available");
  }
}).catch((error) => {
  console.error(error);
});


  })
  .catch((error) => {
    var errorCode = error.code;
    var errorMessage = error.message;
    document.getElementById("loginBtn").disabled = false;
    document.getElementById("loginBtn").innerHTML = "Login";
    document.getElementById("email").value = "";
    document.getElementById("email").focus();
    document.getElementById("password").value = "";
    loginError.hidden = false;
  });
          }, 1000)
        }






        firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    const dbRef = firebase.database().ref();
dbRef.child("users").child(firebase.auth().currentUser.uid).get().then((snapshot) => {
  if (snapshot.exists()) {
    console.log(snapshot.val());


    loginNav.hidden = true;
    document.getElementById("beginNow").innerHTML = "<i style='margin-right:3px;' class='fa-regular fa-circle-user'></i> Welcome, <span style='color:rgb(190, 190, 190);'>" + snapshot.val().firstName + "</span>"
  } else {
    console.log("No data available");
  }
}).catch((error) => {
  console.error(error);
});
  } else {
    // User is signed out
    // ...
  }
});






function register(){
  window.location.assign("https://prepshield.web.app/register");
}


      


        




    </script>
  </body>
</html>